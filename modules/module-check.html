<html><head><title>Cornichon: Property based testing support</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Arnaud Gourlay" /><meta name="description" content="An extensible Scala DSL for testing JSON HTTP APIs." /><meta name="og:image" content="/cornichon/img/poster.png" /><meta name="og:title" content="Cornichon: Property based testing support" /><meta name="og:site_name" content="Cornichon" /><meta name="og:url" content="http://agourlay.github.io/cornichon/" /><meta name="og:type" content="website" /><meta name="og:description" content="An extensible Scala DSL for testing JSON HTTP APIs." /><link rel="icon" type="image/png" href="/cornichon/img/favicon.png" /><meta name="twitter:title" content="Cornichon: Property based testing support" /><meta name="twitter:image" content="http://agourlay.github.io/cornichon/img/poster.png" /><meta name="twitter:description" content="An extensible Scala DSL for testing JSON HTTP APIs." /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/cornichon/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/cornichon/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/cornichon/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/cornichon/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/cornichon/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/cornichon/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/cornichon/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/cornichon/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/cornichon/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/cornichon/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/cornichon/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/cornichon/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/cornichon/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/cornichon/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/cornichon/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/cornichon/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/cornichon/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/cornichon/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/cornichon/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/cornichon/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/cornichon/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/cornichon/css/style.css" /><link rel="stylesheet" href="/cornichon/css/palette.css" /><link rel="stylesheet" href="/cornichon/css/codemirror.css" /><link rel="stylesheet" href="/cornichon/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/cornichon/" class="brand"><div class="brand-wrapper"><span>Cornichon</span></div></a></li> <li><a href="/cornichon/installation.html" class="">Installation</a></li> <li><a href="/cornichon/basics.html" class="">Basics</a></li> <li><a href="/cornichon/dsl.html" class="">DSL</a></li> <li><a href="/cornichon/custom-steps.html" class="">Custom steps</a> <ul class="sub_section"> <li><a href="/cornichon/custom-steps/effect-step.html" class="">Effect step</a></li> <li><a href="/cornichon/custom-steps/assert-step.html" class="">Assert step</a></li> <li><a href="/cornichon/custom-steps/resource-step.html" class="">Resource step</a></li></ul></li> <li><a href="/cornichon/placeholders.html" class="">Placeholders</a></li> <li><a href="/cornichon/json-matchers.html" class="">JSON matchers</a></li> <li><a href="/cornichon/feature-options.html" class="">Feature options</a></li> <li><a href="/cornichon/misc.html" class="">Misc.</a></li> <li><a href="/cornichon/modules.html" class="">Modules</a> <ul class="sub_section"> <li><a href="/cornichon/modules/module-mock.html" class="">HTTP mock</a></li> <li><a href="/cornichon/modules/module-kafka.html" class="">Kafka integration</a></li> <li><a href="/cornichon/modules/module-check.html" class="">Property based testing</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/agourlay/cornichon"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/agourlay/cornichon"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Cornichon An extensible Scala DSL for testing JSON HTTP APIs.');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Cornichon An extensible Scala DSL for testing JSON HTTP APIs.');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="agourlay" data-github-repo="cornichon"><div class="content-wrapper"><section><h1 id="property-based-testing-support">Property based testing support</h1>

<p>There is a support for property based testing through the <code class="highlighter-rouge">cornichon-check</code> module.</p>

<p>The initial inspiration came after reading the following article <a href="https://functional.works-hub.com/learn/property-based-integration-testing-using-haskell-6c25c">Property based integration testing using Haskell!</a> which describes a way to tackle the problem of property based testing for HTTP APIs.</p>

<p>It is still a great introduction to the problem we are trying to solve although the implementations are significantly different.</p>

<h2 id="concepts">Concepts</h2>

<p>Performing property based testing of a pure function is quite easy, for <code class="highlighter-rouge">all</code> possible values, check that a given invariant is valid.</p>

<p>In the case of an HTTP API, it is more difficult to perform such operations, you are more often than not testing that a set of invariants are valid throughout a workflow.</p>

<p>The key idea is to describe the possible interactions with the API as <a href="https://en.wikipedia.org/wiki/Markov_chain">Markov chains</a> which can be automatically explored.</p>

<p>The entry point of the <code class="highlighter-rouge">cornichon-check</code> DSL is reached by mixing the trait <code class="highlighter-rouge">CheckDsl</code> which exposes the following function:</p>

<p><code class="highlighter-rouge">def check_model[A, B, C, D, E, F](maxNumberOfRuns: Int, maxNumberOfTransitions: Int, seed: Option[Long] = None)(modelRunner: ModelRunner[A, B, C, D, E, F])</code></p>

<p>Let’s unpack this signature:</p>

<ul>
  <li><code class="highlighter-rouge">maxNumberOfRuns</code> refers to maximum number of attempt to traverse the Markov chain and find a case that breaks an invariant</li>
  <li><code class="highlighter-rouge">maxNumberOfTransition</code> is useful when the <code class="highlighter-rouge">model</code> contains cycles in order to ensure termination</li>
  <li><code class="highlighter-rouge">seed</code> can be provided in order to trigger a deterministic run</li>
  <li><code class="highlighter-rouge">modelRunner</code> is the actual definition of the <code class="highlighter-rouge">model</code></li>
  <li><code class="highlighter-rouge">A B C D E F</code> refers to the types of the <code class="highlighter-rouge">generators</code> used in <code class="highlighter-rouge">model</code> definition (maximum 6 for the moment)</li>
</ul>

<p>Such Markov chain wires together a set of <code class="highlighter-rouge">actions</code> that relate to each others through <code class="highlighter-rouge">transitions</code> which are chosen according to a given <code class="highlighter-rouge">probability</code>.</p>

<p>Each <code class="highlighter-rouge">action</code> has a set of <code class="highlighter-rouge">pre-conditions</code> and a set of <code class="highlighter-rouge">post-conditions</code> that are checked automatically.</p>

<p>Concretely it means that:</p>
<ul>
  <li>
    <p><code class="highlighter-rouge">pre-conditions</code> are <code class="highlighter-rouge">Steps</code> (they are checked in parallel and the resulting <code class="highlighter-rouge">Sessions</code> are not propagated)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">post-conditions</code> are <code class="highlighter-rouge">Steps</code> (they are checked in parallel and the resulting <code class="highlighter-rouge">Sessions</code> are not propagated)</p>
  </li>
  <li>
    <p>the <code class="highlighter-rouge">action</code> itself is a function from a number of generators to a <code class="highlighter-rouge">Step</code> (the resulting <code class="highlighter-rouge">Session</code> is propagated)</p>
  </li>
</ul>

<p>The number of generators is defined in the <code class="highlighter-rouge">action</code> type:</p>
<ul>
  <li><code class="highlighter-rouge">Action0</code> an action which accepts a function from <code class="highlighter-rouge">() =&gt; Step</code></li>
  <li><code class="highlighter-rouge">Action1[A]</code> an action which accepts a function from <code class="highlighter-rouge">() ⇒ A =&gt; Step</code></li>
  <li><code class="highlighter-rouge">Action2[A, B]</code> an action which accepts a function from <code class="highlighter-rouge">(() ⇒ A, () =&gt; B) =&gt; Step</code></li>
  <li><code class="highlighter-rouge">Action3[A, B, C]</code> an action which accepts a function from <code class="highlighter-rouge">(() ⇒ A, () =&gt; B, () =&gt; C) =&gt; Step</code></li>
  <li>up to <code class="highlighter-rouge">Action6[A, B, C, D, E, F]</code></li>
</ul>

<p>It is of course not required to call a generator when building a <code class="highlighter-rouge">Step</code>.</p>

<p><em>However it is required to have the same <code class="highlighter-rouge">Action</code> type for all actions within a <code class="highlighter-rouge">model</code> definition.</em></p>

<p>Having <code class="highlighter-rouge">generators</code> as input enables the <code class="highlighter-rouge">action</code> to introduce some randomness in its effect.</p>

<p>A <code class="highlighter-rouge">generator</code> is simply a function that accepts a <code class="highlighter-rouge">RandomContext</code> which is propagated throughout the execution, for instance below is an example generating Strings and Ints.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def stringGen(rc: RandomContext): ValueGenerator[String] = ValueGenerator(
  name = "an alphanumeric String (20)",
  genFct = () ⇒ rc.seededRandom.alphanumeric.take(20).mkString(""))

def integerGen(rc: RandomContext): ValueGenerator[Int] = ValueGenerator(
  name = "integer",
  genFct = () ⇒ rc.seededRandom.nextInt(10000))
</code></pre></div></div>

<p>A <code class="highlighter-rouge">run</code> terminates successfully if the max number of transition reached, this means we were not able to break any invariants.</p>

<p>A <code class="highlighter-rouge">run</code> fails if one the following conditions is met:</p>
<ul>
  <li>a <code class="highlighter-rouge">post-condition</code> was broken</li>
  <li>an error is thrown from an <code class="highlighter-rouge">action</code></li>
  <li>no <code class="highlighter-rouge">actions</code> with valid <code class="highlighter-rouge">pre-conditions</code> can be found, this is generally a sign of a malformed <code class="highlighter-rouge">model</code></li>
  <li>a <code class="highlighter-rouge">generator</code> throws an error</li>
</ul>

<p>A <code class="highlighter-rouge">model</code> exploration terminates successfully if the max number of run is reached or with an error if a run fails.</p>

<p>Let’s create our first <code class="highlighter-rouge">model</code>!</p>

<p>It will be a basic chain which will not enforce any invariants; it will have:</p>

<ul>
  <li>an entry point</li>
  <li>a ping action printing a random String</li>
  <li>a pong action printing a random Int</li>
  <li>an exit point</li>
</ul>

<p>We will define the transitions such that:</p>

<ul>
  <li>there is 50% chance to start with ping or pong following the entry point</li>
  <li>there is 90% to go from a ping/pong to a pong/ping</li>
  <li>there is no loop from any action</li>
  <li>there is a 10% chance to exit the game after a ping or a pong</li>
</ul>

<p>Also the DSL is asking for a <code class="highlighter-rouge">modelRunner</code> which is a little helper connecting a <code class="highlighter-rouge">model</code> to its <code class="highlighter-rouge">generators</code>.</p>

<p>The type inference is sometimes not detecting properly the action type, so it is recommended to define the <code class="highlighter-rouge">modelRunner</code> and the <code class="highlighter-rouge">model</code> as a single expression to help the typechecker.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="k">def</span> <span class="n">stringGen</span><span class="o">(</span><span class="n">rc</span><span class="k">:</span> <span class="kt">RandomContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">ValueGenerator</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ValueGenerator</span><span class="o">(</span>
    <span class="n">name</span> <span class="k">=</span> <span class="s">"an alphanumeric String"</span><span class="o">,</span>
    <span class="n">genFct</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="n">rc</span><span class="o">.</span><span class="n">seededRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="n">mkString</span><span class="o">(</span><span class="s">""</span><span class="o">))</span>

  <span class="k">def</span> <span class="n">integerGen</span><span class="o">(</span><span class="n">rc</span><span class="k">:</span> <span class="kt">RandomContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">ValueGenerator</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ValueGenerator</span><span class="o">(</span>
    <span class="n">name</span> <span class="k">=</span> <span class="s">"integer"</span><span class="o">,</span>
    <span class="n">genFct</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="n">rc</span><span class="o">.</span><span class="n">seededRandom</span><span class="o">.</span><span class="n">nextInt</span><span class="o">(</span><span class="mi">10000</span><span class="o">))</span>

  <span class="k">val</span> <span class="n">myModelRunner</span> <span class="k">=</span> <span class="nc">ModelRunner</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">](</span><span class="n">stringGen</span><span class="o">,</span> <span class="n">integerGen</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">val</span> <span class="n">entryPoint</span> <span class="k">=</span> <span class="nc">Action2</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">](</span>
      <span class="n">description</span> <span class="k">=</span> <span class="s">"Entry point"</span><span class="o">,</span>
      <span class="n">effect</span> <span class="k">=</span> <span class="o">(</span><span class="n">stringGen</span><span class="o">,</span> <span class="n">intGen</span><span class="o">)</span> <span class="k">⇒</span> <span class="n">print_step</span><span class="o">(</span><span class="s">"Start game"</span><span class="o">),</span>
      <span class="n">postConditions</span> <span class="k">=</span> <span class="nc">Nil</span>
    <span class="o">)</span>

    <span class="k">val</span> <span class="n">pingString</span> <span class="k">=</span> <span class="nc">Action2</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">](</span>
      <span class="n">description</span> <span class="k">=</span> <span class="s">"Ping String"</span><span class="o">,</span>
      <span class="n">effect</span> <span class="k">=</span> <span class="o">(</span><span class="n">stringGen</span><span class="o">,</span> <span class="n">intGen</span><span class="o">)</span> <span class="k">⇒</span> <span class="n">print_step</span><span class="o">(</span><span class="n">s</span><span class="s">"Ping ${stringGen()}"</span><span class="o">),</span>
      <span class="n">postConditions</span> <span class="k">=</span> <span class="nc">Nil</span>
    <span class="o">)</span>

    <span class="k">val</span> <span class="n">pongInt</span> <span class="k">=</span> <span class="nc">Action2</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">](</span>
      <span class="n">description</span> <span class="k">=</span> <span class="s">"Pong Int"</span><span class="o">,</span>
      <span class="n">effect</span> <span class="k">=</span> <span class="o">(</span><span class="n">stringGen</span><span class="o">,</span> <span class="n">intGen</span><span class="o">)</span> <span class="k">⇒</span> <span class="n">print_step</span><span class="o">(</span><span class="n">s</span><span class="s">"Pong ${intGen()}"</span><span class="o">),</span>
      <span class="n">postConditions</span> <span class="k">=</span> <span class="nc">Nil</span>
    <span class="o">)</span>

    <span class="k">val</span> <span class="n">exitPoint</span> <span class="k">=</span> <span class="nc">Action2</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">](</span>
      <span class="n">description</span> <span class="k">=</span> <span class="s">"Exit point"</span><span class="o">,</span>
      <span class="n">effect</span> <span class="k">=</span> <span class="o">(</span><span class="n">stringGen</span><span class="o">,</span> <span class="n">intGen</span><span class="o">)</span> <span class="k">⇒</span> <span class="n">print_step</span><span class="o">(</span><span class="s">"End of game"</span><span class="o">),</span>
      <span class="n">postConditions</span> <span class="k">=</span> <span class="nc">Nil</span>
    <span class="o">)</span>

    <span class="nc">Model</span><span class="o">(</span>
      <span class="n">description</span> <span class="k">=</span> <span class="s">"our first model"</span><span class="o">,</span>
      <span class="n">startingAction</span> <span class="k">=</span> <span class="n">entryPoint</span><span class="o">,</span>
      <span class="n">transitions</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
        <span class="n">entryPoint</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">0.5</span><span class="o">,</span> <span class="n">pingString</span><span class="o">)</span> <span class="o">::</span> <span class="o">(</span><span class="mf">0.5</span><span class="o">,</span> <span class="n">pongInt</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">),</span>
        <span class="n">pingString</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">0.9</span><span class="o">,</span> <span class="n">pongInt</span><span class="o">)</span> <span class="o">::</span> <span class="o">(</span><span class="mf">0.1</span><span class="o">,</span> <span class="n">exitPoint</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">),</span>
        <span class="n">pongInt</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">0.9</span><span class="o">,</span> <span class="n">pingString</span><span class="o">)</span> <span class="o">::</span> <span class="o">(</span><span class="mf">0.1</span><span class="o">,</span> <span class="n">exitPoint</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>Which gives us the following scenario</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Scenario("My first model") {

  Given I check_model(maxNumberOfRuns = 2, maxNumberOfTransitions = 10)(myModelRunner)

}
</code></pre></div></div>

<p>Running this scenario outputs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Starting scenario 'ping pong check'
- ping pong check (15 millis)

   Scenario : ping pong check
      main steps
      Checking model 'our first model' with maxNumberOfRuns=2 and maxNumberOfTransitions=10 and seed=1541683429241
         Run #1
            Entry point
            Start game
            Ping String ['an alphanumeric String' -&gt; 'GX2A0MYmkXsjO2wVQwfV']
            Ping GX2A0MYmkXsjO2wVQwfV
            Pong Int ['integer' -&gt; '9009']
            Pong 9009
            Ping String ['an alphanumeric String' -&gt; 'eRaUV0kwKvVLkzQDni9Z']
            Ping eRaUV0kwKvVLkzQDni9Z
            Pong Int ['integer' -&gt; '4674']
            Pong 4674
            Ping String ['an alphanumeric String' -&gt; 'qB2lrppZJ5SGoK7j0suP']
            Ping qB2lrppZJ5SGoK7j0suP
            Pong Int ['integer' -&gt; '6587']
            Pong 6587
            Ping String ['an alphanumeric String' -&gt; 'dutwDNaXZitiaOfa6N2X']
            Ping dutwDNaXZitiaOfa6N2X
            Exit point
            End of game
         Run #1 - End reached on action 'Exit point' after 8 transitions
         Run #2
            Entry point
            Start game
            Pong Int ['integer' -&gt; '1786']
            Pong 1786
            Ping String ['an alphanumeric String' -&gt; 'AFGueoVgwvv8j5ouOt5K']
            Ping AFGueoVgwvv8j5ouOt5K
            Pong Int ['integer' -&gt; '7556']
            Pong 7556
            Ping String ['an alphanumeric String' -&gt; 'hr36TFnvv5v3vT09tHrM']
            Ping hr36TFnvv5v3vT09tHrM
            Pong Int ['integer' -&gt; '8657']
            Pong 8657
            Ping String ['an alphanumeric String' -&gt; 'm2n9YSDLvKcZSwJh8JRe']
            Ping m2n9YSDLvKcZSwJh8JRe
            Pong Int ['integer' -&gt; '1705']
            Pong 1705
            Ping String ['an alphanumeric String' -&gt; 'dW5LYKnKbvRnaFop3NPi']
            Ping dW5LYKnKbvRnaFop3NPi
            Pong Int ['integer' -&gt; '9670']
            Pong 9670
            Ping String ['an alphanumeric String' -&gt; 'NcMUhBBIrrwSkDchcNHA']
            Ping NcMUhBBIrrwSkDchcNHA
         Run #2 - Max transitions number per run reached
      Check block succeeded (15 millis)

</code></pre></div></div>

<h2 id="examples">Examples</h2>

<p>Now that we have an understanding of the concepts and their semantics, it is time to dive into some concrete examples!</p>

<h3 id="reversing-strings-one-generator-and-one-transition">Reversing strings (one generator and one transition)</h3>

<p>Below is an example presenting the current <code class="highlighter-rouge">cornichon-check</code> API by checking the contract of HTTP API reversing twice a string.</p>

<p>We want to enforce the following invariant <code class="highlighter-rouge">for any string, if we reverse it twice, it should yield the same value</code>.</p>

<p>The implementation under test is a server accepting <code class="highlighter-rouge">POST</code> requests to <code class="highlighter-rouge">/double-reverse</code> with a query param named <code class="highlighter-rouge">word</code> will return the given <code class="highlighter-rouge">word</code> reversed twice.</p>

<p>This is silly because the Markov chain has only a single transition but it is still a good first example to show to create a <code class="highlighter-rouge">modelRunner</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.agourlay.cornichon.CornichonFeature</span>
<span class="k">import</span> <span class="nn">com.github.agourlay.cornichon.check._</span>
<span class="k">import</span> <span class="nn">com.github.agourlay.cornichon.steps.regular.EffectStep</span>

<span class="k">class</span> <span class="nc">BasicExampleChecks</span> <span class="k">extends</span> <span class="nc">CornichonFeature</span> <span class="k">with</span> <span class="nc">CheckDsl</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">feature</span> <span class="k">=</span> <span class="nc">Feature</span><span class="o">(</span><span class="s">"Basic examples of checks"</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">Scenario</span><span class="o">(</span><span class="s">"reverse a string twice yields the same results"</span><span class="o">)</span> <span class="o">{</span>

      <span class="nc">Given</span> <span class="n">I</span> <span class="n">check_model</span><span class="o">(</span><span class="n">maxNumberOfRuns</span> <span class="k">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">maxNumberOfTransitions</span> <span class="k">=</span> <span class="mi">1</span><span class="o">)(</span><span class="n">doubleReverseModel</span><span class="o">)</span>

    <span class="o">}</span>
  <span class="o">}</span>

  <span class="c1">//The model definition usually lives in another trait
</span>
  <span class="k">def</span> <span class="n">stringGen</span><span class="o">(</span><span class="n">rc</span><span class="k">:</span> <span class="kt">RandomContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">ValueGenerator</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ValueGenerator</span><span class="o">(</span>
    <span class="n">name</span> <span class="k">=</span> <span class="s">"an alphanumeric String (20)"</span><span class="o">,</span>
    <span class="n">genFct</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="n">rc</span><span class="o">.</span><span class="n">seededRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="n">mkString</span><span class="o">(</span><span class="s">""</span><span class="o">))</span>

  <span class="k">private</span> <span class="k">val</span> <span class="n">generateStringAction</span> <span class="k">=</span> <span class="nc">Action1</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span>
    <span class="n">description</span> <span class="k">=</span> <span class="s">"generate and save string"</span><span class="o">,</span>
    <span class="n">preConditions</span> <span class="k">=</span> <span class="n">session_value</span><span class="o">(</span><span class="s">"random-input"</span><span class="o">).</span><span class="n">isAbsent</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">,</span>
    <span class="n">effect</span> <span class="k">=</span> <span class="n">stringGenerator</span> <span class="k">⇒</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">randomString</span> <span class="k">=</span> <span class="n">stringGenerator</span><span class="o">()</span>
      <span class="nc">EffectStep</span><span class="o">.</span><span class="n">fromSyncE</span><span class="o">(</span><span class="n">s</span><span class="s">"save random string '$randomString'"</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">addValue</span><span class="o">(</span><span class="s">"random-input"</span><span class="o">,</span> <span class="n">randomString</span><span class="o">))</span>
    <span class="o">},</span>
    <span class="n">postConditions</span> <span class="k">=</span> <span class="n">session_value</span><span class="o">(</span><span class="s">"random-input"</span><span class="o">).</span><span class="n">isPresent</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>

  <span class="k">private</span> <span class="k">val</span> <span class="n">reverseStringAction</span> <span class="k">=</span> <span class="nc">Action1</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span>
    <span class="n">description</span> <span class="k">=</span> <span class="s">"reverse a string twice yields the same value"</span><span class="o">,</span>
    <span class="n">preConditions</span> <span class="k">=</span> <span class="n">session_value</span><span class="o">(</span><span class="s">"random-input"</span><span class="o">).</span><span class="n">isPresent</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">,</span>
    <span class="n">effect</span> <span class="k">=</span> <span class="k">_</span> <span class="k">⇒</span> <span class="nc">Attach</span> <span class="o">{</span>
      <span class="nc">Given</span> <span class="n">I</span> <span class="n">post</span><span class="o">(</span><span class="s">"/double-reverse"</span><span class="o">).</span><span class="n">withParams</span><span class="o">(</span><span class="s">"word"</span> <span class="o">-&gt;</span> <span class="s">"&lt;random-input&gt;"</span><span class="o">)</span>
      <span class="nc">Then</span> <span class="n">assert</span> <span class="n">status</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
      <span class="nc">And</span> <span class="n">I</span> <span class="n">save_body</span><span class="o">(</span><span class="s">"reversed-twice-random-input"</span><span class="o">)</span>
    <span class="o">},</span>
    <span class="n">postConditions</span> <span class="k">=</span> <span class="n">session_values</span><span class="o">(</span><span class="s">"random-input"</span><span class="o">,</span> <span class="s">"reversed-twice-random-input"</span><span class="o">).</span><span class="n">areEquals</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">doubleReverseModel</span> <span class="k">=</span> <span class="nc">ModelRunner</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">stringGen</span><span class="o">)(</span>
    <span class="nc">Model</span><span class="o">(</span>
      <span class="n">description</span> <span class="k">=</span> <span class="s">"reversing a string twice yields same value"</span><span class="o">,</span>
      <span class="n">startingAction</span> <span class="k">=</span> <span class="n">generateStringAction</span><span class="o">,</span>
      <span class="n">transitions</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
        <span class="n">generateStringAction</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">1.0</span><span class="o">,</span> <span class="n">reverseStringAction</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>

</code></pre></div></div>

<p>To understand what is going on, we can have a look at the logs produced by this scenario.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Starting scenario 'reverse a string twice yields the same results'
- reverse a string twice yields the same results (2087 millis)

   Scenario : reverse a string twice yields the same results
      main steps
      Checking model 'reversing a string twice yields same value' with maxNumberOfRuns=5 and maxNumberOfTransitions=1 and seed=1541177654821
         Run #1
            generate and save string ['an alphanumeric String (20)' -&gt; 'zCFAPwANfohFhQx4h6Pl']
            save random string 'zCFAPwANfohFhQx4h6Pl' (6 millis)
            reverse a string twice yields the same value
            Given I POST /double-reverse with query parameters 'word' -&gt; 'zCFAPwANfohFhQx4h6Pl' (1328 millis)
            Then assert status is '200' (2 millis)
            And I save path '$' from body to key 'reversed-twice-random-input' (23 millis)
         Run #1 - End reached on action 'reverse a string twice yields the same value' after 1 transitions
         Run #2
            generate and save string ['an alphanumeric String (20)' -&gt; 'jfQadaz86jXxP7AoBNST']
            save random string 'jfQadaz86jXxP7AoBNST' (0 millis)
            reverse a string twice yields the same value
            Given I POST /double-reverse with query parameters 'word' -&gt; 'jfQadaz86jXxP7AoBNST' (6 millis)
            Then assert status is '200' (0 millis)
            And I save path '$' from body to key 'reversed-twice-random-input' (0 millis)
         Run #2 - End reached on action 'reverse a string twice yields the same value' after 1 transitions
         Run #3
            generate and save string ['an alphanumeric String (20)' -&gt; 'O6SVBD9CQxUXN2Ag1mL3']
            save random string 'O6SVBD9CQxUXN2Ag1mL3' (0 millis)
            reverse a string twice yields the same value
            Given I POST /double-reverse with query parameters 'word' -&gt; 'O6SVBD9CQxUXN2Ag1mL3' (5 millis)
            Then assert status is '200' (0 millis)
            And I save path '$' from body to key 'reversed-twice-random-input' (0 millis)
         Run #3 - End reached on action 'reverse a string twice yields the same value' after 1 transitions
         Run #4
            generate and save string ['an alphanumeric String (20)' -&gt; '0nbLBgwP4eE9QqOeCbOn']
            save random string '0nbLBgwP4eE9QqOeCbOn' (0 millis)
            reverse a string twice yields the same value
            Given I POST /double-reverse with query parameters 'word' -&gt; '0nbLBgwP4eE9QqOeCbOn' (4 millis)
            Then assert status is '200' (0 millis)
            And I save path '$' from body to key 'reversed-twice-random-input' (0 millis)
         Run #4 - End reached on action 'reverse a string twice yields the same value' after 1 transitions
         Run #5
            generate and save string ['an alphanumeric String (20)' -&gt; '1RgTnx5ohrjhnZHKDHZO']
            save random string '1RgTnx5ohrjhnZHKDHZO' (0 millis)
            reverse a string twice yields the same value
            Given I POST /double-reverse with query parameters 'word' -&gt; '1RgTnx5ohrjhnZHKDHZO' (4 millis)
            Then assert status is '200' (0 millis)
            And I save path '$' from body to key 'reversed-twice-random-input' (0 millis)
         Run #5 - End reached on action 'reverse a string twice yields the same value' after 1 transitions
      Check block succeeded (2002 millis)
</code></pre></div></div>

<p>The logs show that:</p>
<ul>
  <li>we have performed 5 runs of 1 transition each through the <code class="highlighter-rouge">model</code></li>
  <li>each run called <code class="highlighter-rouge">generateStringAction</code> followed by <code class="highlighter-rouge">reverseStringAction</code> which is the only transition defined</li>
  <li>each run stopped because no other transitions are left to explore from <code class="highlighter-rouge">reverseStringAction</code></li>
  <li>the string generator has been called for each run</li>
  <li>no post-condition has been broken</li>
</ul>

<p>The source for the test and the server are available <a href="https://github.com/agourlay/cornichon/tree/master/cornichon-check/src/test/scala/com/github/agourlay/cornichon/check/examples/stringReverse">here</a>.</p>

<h3 id="turnstile-no-generator-and-cyclic-transitions">Turnstile (no generator and cyclic transitions)</h3>

<p>Having <code class="highlighter-rouge">cornichon-check</code> freely explore the <code class="highlighter-rouge">transitions</code> of a <code class="highlighter-rouge">model</code> can create some interesting configurations.</p>

<p>In this example we are going to test an HTTP API implementing a basic turnstile.</p>

<p>This is a rotating gate that let people pass one at the time after payment. In our simplified model it is not possible to pay for several people to pass in advance.</p>

<p>The server exposed two endpoints:</p>
<ul>
  <li>a <code class="highlighter-rouge">POST</code> request on <code class="highlighter-rouge">/push-coin</code> to unlock the gate</li>
  <li>a <code class="highlighter-rouge">POST</code> request on <code class="highlighter-rouge">/walk-through</code> to turn the gate</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.agourlay.cornichon.CornichonFeature</span>
<span class="k">import</span> <span class="nn">com.github.agourlay.cornichon.check._</span>

<span class="k">class</span> <span class="nc">TurnstileCheck</span> <span class="k">extends</span> <span class="nc">CornichonFeature</span> <span class="k">with</span> <span class="nc">CheckDsl</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">feature</span> <span class="k">=</span> <span class="nc">Feature</span><span class="o">(</span><span class="s">"Basic examples of checks"</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">Scenario</span><span class="o">(</span><span class="s">"Turnstile acts according to model"</span><span class="o">)</span> <span class="o">{</span>

      <span class="nc">Given</span> <span class="n">I</span> <span class="n">check_model</span><span class="o">(</span><span class="n">maxNumberOfRuns</span> <span class="k">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">maxNumberOfTransitions</span> <span class="k">=</span> <span class="mi">10</span><span class="o">)(</span><span class="n">turnstileModel</span><span class="o">)</span>

    <span class="o">}</span>
  <span class="o">}</span>

  <span class="c1">//Model definition usually in another trait
</span>
  <span class="k">private</span> <span class="k">val</span> <span class="n">pushCoinAction</span> <span class="k">=</span> <span class="nc">Action0</span><span class="o">(</span>
    <span class="n">description</span> <span class="k">=</span> <span class="s">"push a coin"</span><span class="o">,</span>
    <span class="n">effect</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="nc">Given</span> <span class="n">I</span> <span class="n">post</span><span class="o">(</span><span class="s">"/push-coin"</span><span class="o">),</span>
    <span class="n">postConditions</span> <span class="k">=</span> <span class="n">status</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span> <span class="o">::</span> <span class="n">body</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="s">"payment accepted"</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>

  <span class="k">private</span> <span class="k">val</span> <span class="n">pushCoinBlockedAction</span> <span class="k">=</span> <span class="nc">Action0</span><span class="o">(</span>
    <span class="n">description</span> <span class="k">=</span> <span class="s">"push a coin is a blocked"</span><span class="o">,</span>
    <span class="n">effect</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="nc">Given</span> <span class="n">I</span> <span class="n">post</span><span class="o">(</span><span class="s">"/push-coin"</span><span class="o">),</span>
    <span class="n">postConditions</span> <span class="k">=</span> <span class="n">status</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="mi">400</span><span class="o">)</span> <span class="o">::</span> <span class="n">body</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="s">"payment refused"</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>

  <span class="k">private</span> <span class="k">val</span> <span class="n">walkThroughOkAction</span> <span class="k">=</span> <span class="nc">Action0</span><span class="o">(</span>
    <span class="n">description</span> <span class="k">=</span> <span class="s">"walk through ok"</span><span class="o">,</span>
    <span class="n">effect</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="nc">Given</span> <span class="n">I</span> <span class="n">post</span><span class="o">(</span><span class="s">"/walk-through"</span><span class="o">),</span>
    <span class="n">postConditions</span> <span class="k">=</span> <span class="n">status</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span> <span class="o">::</span> <span class="n">body</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="s">"door turns"</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>

  <span class="k">private</span> <span class="k">val</span> <span class="n">walkThroughBlockedAction</span> <span class="k">=</span> <span class="nc">Action0</span><span class="o">(</span>
    <span class="n">description</span> <span class="k">=</span> <span class="s">"walk through blocked"</span><span class="o">,</span>
    <span class="n">effect</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="nc">Given</span> <span class="n">I</span> <span class="n">post</span><span class="o">(</span><span class="s">"/walk-through"</span><span class="o">),</span>
    <span class="n">postConditions</span> <span class="k">=</span> <span class="n">status</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="mi">400</span><span class="o">)</span> <span class="o">::</span> <span class="n">body</span><span class="o">.</span><span class="n">is</span><span class="o">(</span><span class="s">"door blocked"</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">turnstileModel</span> <span class="k">=</span> <span class="nc">ModelRunner</span><span class="o">.</span><span class="n">makeNoGen</span><span class="o">(</span>
    <span class="nc">Model</span><span class="o">(</span>
      <span class="n">description</span> <span class="k">=</span> <span class="s">"Turnstile acts according to model"</span><span class="o">,</span>
      <span class="n">startingAction</span> <span class="k">=</span> <span class="n">pushCoinAction</span><span class="o">,</span>
      <span class="n">transitions</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
        <span class="n">pushCoinAction</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">0.9</span><span class="o">,</span> <span class="n">walkThroughOkAction</span><span class="o">)</span> <span class="o">::</span> <span class="o">(</span><span class="mf">0.1</span><span class="o">,</span> <span class="n">pushCoinBlockedAction</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">),</span>
        <span class="n">pushCoinBlockedAction</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">0.9</span><span class="o">,</span> <span class="n">walkThroughOkAction</span><span class="o">)</span> <span class="o">::</span> <span class="o">(</span><span class="mf">0.1</span><span class="o">,</span> <span class="n">pushCoinBlockedAction</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">),</span>
        <span class="n">walkThroughOkAction</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">0.7</span><span class="o">,</span> <span class="n">pushCoinAction</span><span class="o">)</span> <span class="o">::</span> <span class="o">(</span><span class="mf">0.3</span><span class="o">,</span> <span class="n">walkThroughBlockedAction</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">),</span>
        <span class="n">walkThroughBlockedAction</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="mf">0.9</span><span class="o">,</span> <span class="n">pushCoinAction</span><span class="o">)</span> <span class="o">::</span> <span class="o">(</span><span class="mf">0.1</span><span class="o">,</span> <span class="n">walkThroughBlockedAction</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Again let’s have a look at the logs to see how things go.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Basic examples of checks:
Starting scenario 'Turnstile acts according to model'
- Turnstile acts according to model (59 millis)

   Scenario : Turnstile acts according to model
      main steps
      Checking model 'Turnstile acts according to model' with maxNumberOfRuns=1 and maxNumberOfTransitions=10 and seed=1541225049797
         Run #1
            push a coin
            Given I POST /push-coin (9 millis)
            walk through ok
            Given I POST /walk-through (4 millis)
            push a coin
            Given I POST /push-coin (4 millis)
            walk through ok
            Given I POST /walk-through (3 millis)
            walk through blocked
            Given I POST /walk-through (3 millis)
            walk through blocked
            Given I POST /walk-through (3 millis)
            push a coin
            Given I POST /push-coin (3 millis)
            push a coin is a blocked
            Given I POST /push-coin (3 millis)
            walk through ok
            Given I POST /walk-through (3 millis)
            push a coin
            Given I POST /push-coin (3 millis)
            walk through ok
            Given I POST /walk-through (4 millis)
         Run #1 - Max transitions number per run reached
      Check block succeeded (56 millis)
</code></pre></div></div>

<p>It is interesting to note that we are executing a single run on purpose, as the server is stateful, the run would share the global state of the turnstile.</p>

<p>This is an issue because we are starting our model with <code class="highlighter-rouge">pushCoinAction</code> which is always expected to succeed.</p>

<p>Let’s try to the same model with more run to see if it breaks!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Basic examples of checks:
Starting scenario 'Turnstile acts according to model'
- **failed** Turnstile acts according to model (132 millis)

  Scenario 'Turnstile acts according to model' failed:

  at step:
  Checking model 'Turnstile acts according to model' with maxNumberOfRuns=2 and maxNumberOfTransitions=10 and seed=1541251694854

  with error(s):
  A post-condition was broken for `push a coin`
  caused by:
  expected status code '200' but '400' was received with body:
  "payment refused"
  and with headers:
  'Date' -&gt; 'Sat, 03 Nov 2018 13:28:14 GMT'
  and
  expected result was:
  '"payment accepted"'
  but actual result is:
  '"payment refused"'

  JSON patch between actual result and expected result is :
  [
    {
      "op" : "replace",
      "path" : "",
      "value" : "payment refused",
      "old" : "payment accepted"
    }
  ]

  replay only this scenario with the command:
  testOnly *TurnstileCheck -- "Turnstile acts according to model"

   Scenario : Turnstile acts according to model
      main steps
      Checking model 'Turnstile acts according to model' with maxNumberOfRuns=2 and maxNumberOfTransitions=10 and seed=1541251694854
         Run #1
            push a coin
            Given I POST /push-coin (9 millis)
            walk through ok
            Given I POST /walk-through (4 millis)
            push a coin
            Given I POST /push-coin (4 millis)
            walk through ok
            Given I POST /walk-through (4 millis)
            push a coin
            Given I POST /push-coin (4 millis)
            walk through ok
            Given I POST /walk-through (3 millis)
            walk through blocked
            Given I POST /walk-through (4 millis)
            walk through blocked
            Given I POST /walk-through (3 millis)
            push a coin
            Given I POST /push-coin (3 millis)
            walk through ok
            Given I POST /walk-through (3 millis)
            push a coin
            Given I POST /push-coin (4 millis)
         Run #1 - Max transitions number per run reached
         Run #2
            push a coin
            Given I POST /push-coin (3 millis)
            A post-condition was broken for `push a coin`
            caused by:
            expected status code '200' but '400' was received with body:
            "payment refused"
            and with headers:
            'Date' -&gt; 'Sat, 03 Nov 2018 13:28:14 GMT'
            and
            expected result was:
            '"payment accepted"'
            but actual result is:
            '"payment refused"'

            JSON patch between actual result and expected result is :
            [
              {
                "op" : "replace",
                "path" : "",
                "value" : "payment refused",
                "old" : "payment accepted"
              }
            ]
         Run #2 - Failed
      Check model block failed  (131 millis)
</code></pre></div></div>

<p>Using 2 runs, we found already the problem because the first run finished by introducing a coin.</p>

<p>It is possible to replay exactly this run in a deterministic fashion by using the <code class="highlighter-rouge">seed</code> printed in the logs and feed it to the DSL.</p>

<p><code class="highlighter-rouge">Given I check_model(maxNumberOfRuns = 2, maxNumberOfTransitions = 10, seed = Some(1541251694854L))(turnstileModel)</code></p>

<p>This example shows that designing test scenarios with <code class="highlighter-rouge">cornichon-check</code> is sometimes challenging in the case of shared mutable state.</p>

<p>The source for the test and the server are available <a href="https://github.com/agourlay/cornichon/tree/master/cornichon-check/src/test/scala/com/github/agourlay/cornichon/check/examples/turnstile">here</a>.</p>

<h3 id="web-shop-admin-several-generators-and-cyclic-transitions">Web shop Admin (several generators and cyclic transitions)</h3>

<p>// TODO</p>

<h2 id="caveats">Caveats</h2>

<ul>
  <li>all actions must have the same types within a <code class="highlighter-rouge">model</code> definition</li>
  <li>the API has a few rough edges, especially regarding type inference for the <code class="highlighter-rouge">modelRunner</code> definition</li>
  <li>placeholders generating random data such as <code class="highlighter-rouge">&lt;random-string</code> and <code class="highlighter-rouge">random-uuid</code> are not yet using the correct <code class="highlighter-rouge">seed</code></li>
  <li>the max number of <code class="highlighter-rouge">generators</code> is hard-coded to 6</li>
</ul>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/cornichon/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'agourlay/cornichon'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/cornichon/js/main.js"></script></body></html>